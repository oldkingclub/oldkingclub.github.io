(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0cc795"],{"4da0":function(t,a,s){"use strict";s.r(a);var o=function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("v-card",[s("v-card-title",[s("h2",[t._v("数据表")])]),s("v-card-text",{staticClass:"pa-5"},[s("v-data-table",{attrs:{headers:t.headers,items:t.tabledata,options:t.options,"no-data-text":"暂无数据",dense:"","server-items-length":t.total_rows,"footer-props":{"items-per-page-options":t.items_per_page_options,"show-first-last-page":!0}},on:{"update:options":function(a){t.options=a}},scopedSlots:t._u([{key:"top",fn:function(){return[s("v-toolbar",{staticClass:"mb-8",attrs:{flat:""}},[s("v-row",[s("v-col",{attrs:{cols:"12",md:"6",lg:"4"}},[s("v-btn",{staticClass:"mb-2 text-capitalize",attrs:{disabled:!t.load_data,color:"primary"},on:{click:t.load_csv_data}},[s("v-icon",{staticClass:"mr-2"},[t._v("mdi-reload")]),s("span",[t._v("加载数据")])],1)],1),s("v-col",{attrs:{cols:"12",md:"6",lg:"4"}},[s("v-btn",{staticClass:"mb-2 text-capitalize",attrs:{disabled:!t.check_can_upload,color:"primary"},on:{click:t.check_can_upload_fun}},[s("v-icon",{staticClass:"mr-2"},[t._v("mdi-cloud-download")]),s("span",[t._v("校验数据")])],1)],1),s("v-col",{attrs:{cols:"12",md:"6",lg:"4"}},[s("v-btn",{staticClass:"mb-2 text-capitalize",attrs:{disabled:!t.upload,color:"primary"},on:{click:t.upload2db}},[s("v-icon",{staticClass:"mr-2"},[t._v("mdi-cloud-upload")]),s("span",[t._v("上传数据")])],1)],1)],1)],1)]},proxy:!0}])})],1)],1)},e=[],c=s("84b5"),l=s("ca39"),i={data:function(){return{height:400,expanded:[],singleExpand:!0,options:{},tabledata:[],total_rows:10,load_data:!1,check_can_upload:!1,upload:!1,batchsize:3e3}},computed:{items_per_page_options:Object(c["d"])("db/items_per_page_options"),collection_config:Object(c["d"])("db/collection_config"),headers:Object(c["b"])("db/headers"),filepath:Object(c["b"])("db/uploaded_file_path"),file_hash:Object(c["b"])("db/file_hash"),collection:Object(c["d"])("db/collection")},methods:{load_csv_data:function(){var t=this;console.log("load_csv_data",this.file_hash,this.filepath);var a=this.file_hash;if(a){var s=this.filepath[a];s?this.collection?(console.log("LocalReadColCsvData"),l["hb"]({hash:a,collection:this.collection,path:s}).then((function(a){200==a.code?(console.log("LocalReadColCsvData res",a),t.check_can_upload=!0,t.update_csv_page_data()):(t.$store.dispatch("msglog/push_msg",{message:a.msg+a.error,type:"error"}),t.check_can_upload=!1,t.$store.dispatch("db/update_csv_header_map",a.headermap),t.tabledata=[])}))):console.log("未选择数据库"):console.log("文件未上传到服务器",a)}},update_csv_page_data:function(){var t=this;if(this.file_hash){var a=this.options.page,s=this.options.itemsPerPage;l["gb"]({hash:this.file_hash,page:a,pagesize:s}).then((function(a){if(200==a.code){console.log("更新分页成功",a),t.tabledata=a.data,t.total_rows=a.total;var s={};for(var o in a.data[0])s[o]=!0;t.$store.dispatch("db/update_csv_header_map",s)}else console.log("更新分页失败",a),t.$store.dispatch("msglog/push_msg",{message:a.msg,type:"error"})}))}},check_can_upload_fun:function(){var t=this;this.file_hash&&this.collection&&l["eb"]({hash:this.file_hash,collection:this.collection}).then((function(a){200==a.code?(t.upload=!0,t.$store.dispatch("msglog/push_msg",{message:a.msg,type:"success"})):(console.log("无法上传到数据库",a),t.$store.dispatch("msglog/push_msg",{message:a.msg+a.error,type:"error"}))}))},upload2db:function(){var t=this;this.file_hash&&this.collection&&l["ib"]({hash:this.file_hash,collection:this.collection,batchsize:this.batchsize}).then((function(a){200==a.code?(t.$store.dispatch("msglog/push_msg",{message:a.msg,type:"success"}),t.upload=!1):(console.log("无法上传到数据库",a),t.$store.dispatch("msglog/push_msg",{message:a.msg+a.error,type:"error"}))}))}},watch:{options:{handler:function(){console.log("页面刷新",this.options),this.update_csv_page_data()},deep:!0},file_hash:function(){console.log("文件hash变化",this.file_hash),this.load_data=!0},collection:function(){this.check_can_upload=!1}}},n=i,d=s("c701"),h=s("7033"),r=s.n(h),p=s("fd3f"),_=s("dbcd"),g=s("6e06"),u=s("30b0"),m=s("f017"),f=s("afe4"),b=s("ff00"),v=s("331e"),C=Object(d["a"])(n,o,e,!1,null,null,null);a["default"]=C.exports;r()(C,{VBtn:p["a"],VCard:_["a"],VCardText:g["b"],VCardTitle:g["c"],VCol:u["a"],VDataTable:m["a"],VIcon:f["a"],VRow:b["a"],VToolbar:v["a"]})}}]);
//# sourceMappingURL=chunk-2d0cc795.b78825f0.js.map